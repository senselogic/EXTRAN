<meta charset="utf-8">
<style>
    *
    {
        padding : 0;
        margin : 0;
    }

    table
    {
        border-collapse : collapse;
    }

    textarea
    {
        overflow : scroll;
        resize : none;
        white-space: pre;
    }
</style>
<table>
    <tbody>
        <tr>
            <td colspan="2">
                <textarea id="OldText" placeholder="Old text" spellcheck="false" style="width:49vw;height:25vh"></textarea>
            </td>
            <td colspan="2">
                <textarea id="NewText" placeholder="New text" spellcheck="false" style="width:49vw;height:25vh"></textarea>
            </td>
        </tr>
        <tr>
            <td>
                <input id="LinePrefix" type="text" placeholder="Line prefix" style="width:24.5vw;height:5vh"/>
            </td>
            <td>
                <input id="LineSuffix" type="text" placeholder="Line suffix" style="width:24.5vw;height:5vh"/>
            </td>
            <td>
                <input id="PhrasePrefix" type="text" placeholder="Phrase prefix" style="width:24.5vw;height:5vh"/>
            </td>
            <td>
                <input id="PhraseSuffix" type="text" placeholder="Phrase suffix" style="width:24.5vw;height:5vh"/>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input id="OldIdentifier" type="text" placeholder="Old identifier" style="width:49vw;height:5vh"/>
            </td>
            <td colspan="2">
                <input id="NewIdentifier0" type="text" placeholder="New identifier" style="width:49vw;height:5vh"/>
                <input id="NewIdentifier1" type="text" placeholder="New identifier" style="width:49vw;height:5vh;display:none"/>
                <input id="NewIdentifier2" type="text" placeholder="New identifier" style="width:49vw;height:5vh;display:none"/>
                <input id="NewIdentifier3" type="text" placeholder="New identifier" style="width:49vw;height:5vh;display:none"/>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input id="OldLineOffset" type="text" placeholder="" readonly style="width:49vw;height:5vh"/>
            </td>
            <td colspan="2">
                <input id="NewLineOffset0" type="text" placeholder="New line offset" style="width:49vw;height:5vh"/>
                <input id="NewLineOffset1" type="text" placeholder="New line offset" style="width:49vw;height:5vh;display:none"/>
                <input id="NewLineOffset2" type="text" placeholder="New line offset" style="width:49vw;height:5vh;display:none"/>
                <input id="NewLineOffset3" type="text" placeholder="New line offset" style="width:49vw;height:5vh;display:none"/>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <textarea id="OldTranslation" placeholder="Old translated text" readonly spellcheck="false" onInput="SetRowCount( this )" style="width:49vw;height:50vh"></textarea>
            </td>
            <td colspan="2">
                <textarea id="NewTranslation0" placeholder="New translated text" spellcheck="false" onInput="SetRowCount( this )" style="width:49vw;height:50vh"></textarea>
                <textarea id="NewTranslation1" placeholder="New translated text" spellcheck="false" onInput="SetRowCount( this )" style="width:49vw;height:50vh;display:none"></textarea>
                <textarea id="NewTranslation2" placeholder="New translated text" spellcheck="false" onInput="SetRowCount( this )" style="width:49vw;height:50vh;display:none"></textarea>
                <textarea id="NewTranslation3" placeholder="New translated text" spellcheck="false" onInput="SetRowCount( this )" style="width:49vw;height:50vh;display:none"></textarea>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input id="OldRowCount" placeholder="0" readonly style="width:49vw;height:5vh"/>
            </td>
            <td colspan="2">
                <input id="NewRowCount0" placeholder="0" readonly style="width:49vw;height:5vh"/>
                <input id="NewRowCount1" placeholder="0" readonly style="width:49vw;height:5vh;display:none"/>
                <input id="NewRowCount2" placeholder="0" readonly style="width:49vw;height:5vh;display:none"/>
                <input id="NewRowCount3" placeholder="0" readonly style="width:49vw;height:5vh;display:none"/>
            </td>
        </tr>
    </tbody>
</table>
<button onclick="ExtractPhrases()" style="font-size:1.5vw">Extract</button>
<button onclick="ReplacePhrases()" style="font-size:1.5vw">Replace</button>
<button onclick="AddPhrases()" style="font-size:1.5vw">Add</button>
<input id="Translation0" type="radio" name="translation" onClick="ShowTranslation( 0 )">
<label for="Translation0" style="font-size:1.5vw">First translation</label>
<input id="Translation1" type="radio" name="translation" onClick="ShowTranslation( 1 )">
<label for="Translation1" style="font-size:1.5vw">Second translation</label>
<input id="Translation2" type="radio" name="translation" onClick="ShowTranslation( 2 )">
<label for="Translation2" style="font-size:1.5vw">Third translation</label>
<input id="Translation3" type="radio" name="translation" onClick="ShowTranslation( 3 )">
<label for="Translation3" style="font-size:1.5vw">Fourth translation</label>
<script>
    // -- FUNCTIONS

    function SetRowCount(
        phrase_array
        )
    {
        document.getElementById( phrase_array.id.split( "Translation" ).join( "RowCount" ) ).value
            = phrase_array.value.split( "\n" ).length;
    }

    // ~~

    function ShowTranslation(
        shown_translation_index
        )
    {
        for ( translation_index = 0;
              translation_index < 4;
              ++translation_index )
        {
            if ( translation_index === shown_translation_index )
            {
                display_value = "inline";
            }
            else
            {
                display_value = "none";
            }

            document.getElementById( "NewIdentifier" + translation_index ).style.display = display_value;
            document.getElementById( "NewLineOffset" + translation_index ).style.display = display_value;
            document.getElementById( "NewTranslation" + translation_index ).style.display = display_value;
            document.getElementById( "NewRowCount" + translation_index ).style.display = display_value;
        }
    }

    // ~~

    function GetPartArray(
        line,
        line_prefix,
        line_suffix,
        phrase_prefix,
        phrase_suffix
        )
    {
        var
            phrase_prefix_character_index,
            phrase_suffix_character_index;

        if ( line_prefix !== "" )
        {
            if ( line.startsWith( line_prefix ) )
            {
                line = line.substring( line_prefix.length );
            }
            else
            {
                return [];
            }
        }

        if ( line_suffix !== "" )
        {
            if ( line.endsWith( line_suffix ) )
            {
                line = line.substring( 0, line.length - line_suffix.length );
            }
            else
            {
                return [];
            }
        }

        if ( phrase_prefix !== "" )
        {
            phrase_prefix_character_index = line.indexOf( phrase_prefix );

            if ( phrase_prefix_character_index >= 0 )
            {
                phrase_prefix = line.substring( 0, phrase_prefix_character_index + phrase_prefix.length );
                line = line.substring( phrase_prefix.length );
            }
            else
            {
                return [];
            }
        }

        if ( phrase_suffix !== "" )
        {
            phrase_suffix_character_index = line.indexOf( phrase_suffix );

            if ( phrase_suffix_character_index >= 0 )
            {
                phrase_suffix = line.substring( phrase_suffix_character_index );
                line = line.substring( 0, phrase_suffix_character_index );
            }
            else
            {
                return [];
            }
        }

        return [ line_prefix + phrase_prefix, line, phrase_suffix + line_suffix ];
    }

    // ~~

    function ExtractPhrases(
        )
    {
        var
            line_prefix,
            line_suffix,
            old_line,
            old_line_array,
            old_line_index,
            old_part_array,
            old_phrase_array,
            old_translation_element,
            phrase_prefix,
            phrase_suffix;

        old_line_array = document.getElementById( "OldText" ).value.split( "\n" );

        line_prefix = document.getElementById( "LinePrefix" ).value;
        line_suffix = document.getElementById( "LineSuffix" ).value;

        phrase_prefix = document.getElementById( "PhrasePrefix" ).value;
        phrase_suffix = document.getElementById( "PhraseSuffix" ).value;

        old_phrase_array = [];

        for ( old_line_index = 0;
              old_line_index < old_line_array.length;
              ++old_line_index )
        {
            old_line = old_line_array[ old_line_index ];
            old_part_array = GetPartArray( old_line, line_prefix, line_suffix, phrase_prefix, phrase_suffix );

            if ( old_part_array.length == 3 )
            {
                old_phrase_array.push( old_part_array[ 1 ] );
            }
        }

        old_translation_element = document.getElementById( "OldTranslation" );
        old_translation_element.value = old_phrase_array.join( "\n" );

        SetRowCount( old_translation_element );
    }

    // ~~

    function GetLineOffset(
        text
        )
    {
        if ( text === "" )
        {
            return 1;
        }
        else
        {
            return text * 1;
        }
    }

    // ~~

    function IntegratePhrases(
        old_line_is_replaced = false
        )
    {
        var
            new_translation_index,
            line_prefix,
            line_suffix,
            new_line,
            new_line_array,
            new_line_index,
            new_line_offset,
            new_line_offset_array,
            new_identifier_array,
            new_phrase_array_array,
            new_translation_array,
            old_identifier,
            old_line,
            old_line_array,
            old_line_index,
            old_part_array,
            old_phrase_array,
            old_translation,
            phrase_index,
            phrase_prefix,
            phrase_suffix;

        old_line_array = document.getElementById( "OldText" ).value.split( "\n" );
        new_line_array = old_line_array.slice();

        line_prefix = document.getElementById( "LinePrefix" ).value;
        line_suffix = document.getElementById( "LineSuffix" ).value;

        phrase_prefix = document.getElementById( "PhrasePrefix" ).value;
        phrase_suffix = document.getElementById( "PhraseSuffix" ).value;

        old_identifier = document.getElementById( "OldIdentifier" ).value;
        new_identifier_array
            = [
                  document.getElementById( "NewIdentifier0" ).value,
                  document.getElementById( "NewIdentifier1" ).value,
                  document.getElementById( "NewIdentifier2" ).value,
                  document.getElementById( "NewIdentifier3" ).value
              ];

        new_line_offset_array
            = [
                  document.getElementById( "NewLineOffset0" ).value,
                  document.getElementById( "NewLineOffset1" ).value,
                  document.getElementById( "NewLineOffset2" ).value,
                  document.getElementById( "NewLineOffset3" ).value
              ];

        old_translation = document.getElementById( "OldTranslation" ).value;
        new_translation_array
            = [
                  document.getElementById( "NewTranslation0" ).value,
                  document.getElementById( "NewTranslation1" ).value,
                  document.getElementById( "NewTranslation2" ).value,
                  document.getElementById( "NewTranslation3" ).value
              ];

        old_phrase_array = old_translation.split( "\n" );
        new_phrase_array_array
            = [
                  new_translation_array[ 0 ].split( "\n" ),
                  new_translation_array[ 1 ].split( "\n" ),
                  new_translation_array[ 2 ].split( "\n" ),
                  new_translation_array[ 3 ].split( "\n" )
              ];

        phrase_index = 0;

        new_line_index = 0;

        for ( old_line_index = 0;
              old_line_index < old_line_array.length;
              ++old_line_index )
        {
            old_line = old_line_array[ old_line_index ];
            old_part_array = GetPartArray( old_line, line_prefix, line_suffix, phrase_prefix, phrase_suffix );

            if ( old_part_array.length == 3 )
            {
                if ( old_line_is_replaced )
                {
                    new_line_array.splice( new_line_index, 1 );

                    --new_line_index;
                }

                for ( new_translation_index = 0;
                      new_translation_index < 4;
                      ++new_translation_index )
                {
                    if ( new_translation_array[ new_translation_index ] !== "" )
                    {
                        if ( phrase_index < new_phrase_array_array[ new_translation_index ].length
                             && new_phrase_array_array[ new_translation_index ].length === old_phrase_array.length )
                        {
                            new_line_offset = new_line_offset_array[ new_translation_index ];

                            if ( new_line_offset === "" )
                            {
                                new_line_offset = 1;
                            }
                            else
                            {
                                new_line_offset *= 1;
                            }

                            new_line
                                = old_part_array[ 0 ].split( old_identifier ).join( new_identifier_array[ new_translation_index ] )
                                  + new_phrase_array_array[ new_translation_index ][ phrase_index ]
                                  + old_part_array[ 2 ].split( old_identifier ).join( new_identifier_array[ new_translation_index ] );

                            new_line_array.splice(
                                new_line_index + new_line_offset,
                                0,
                                new_line
                                );

                            if ( new_line_offset <= 1 )
                            {
                                ++new_line_index;
                            }
                        }
                        else
                        {
                            document.getElementById( "Translation" + new_translation_index ).click();

                            alert( "Invalid line count : " + new_phrase_array_array[ new_translation_index ].length );

                            return;
                        }
                    }
                }

                ++phrase_index;
            }

            ++new_line_index;
        }

        document.getElementById( "NewText" ).value = new_line_array.join( "\n" );
    }

    // ~~

    function ReplacePhrases(
        )
    {
        IntegratePhrases( true );
    }

    // ~~

    function AddPhrases(
        )
    {
        IntegratePhrases( false );
    }

    // -- STATEMENTS

    document.getElementById( "Translation0" ).click();
</script>
