<meta charset="utf-8">
<style>
    *
    {
        padding : 0;
        margin : 0;
    }

    table
    {
        border-collapse : collapse;
    }

    textarea
    {
        overflow : scroll;
        resize : none;
        white-space: pre;
    }
</style>
<table>
    <tbody>
        <tr>
            <td colspan="2">
                <textarea id="OldText" placeholder="Old text" spellcheck="false" style="width:49vw;height:25vh"></textarea>
            </td>
            <td colspan="2">
                <textarea id="NewText" placeholder="New text" spellcheck="false" style="width:49vw;height:25vh"></textarea>
            </td>
        </tr>
        <tr>
            <td>
                <input id="RequiredLinePrefix" type="text" placeholder="Required Line prefix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RequiredLineSuffix" type="text" placeholder="Required Line suffix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhrasePrefix0" type="text" placeholder="Removed Phrase prefix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhraseSuffix0" type="text" placeholder="Removed Phrase suffix" style="width:24.5vw;height:2.5vh"/>
            </td>
        </tr>
        <tr>
            <td>
                <input id="RequiredPhrasePrefix" type="text" placeholder="Required Phrase prefix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RequiredPhraseSuffix" type="text" placeholder="Required Phrase suffix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhrasePrefix1" type="text" placeholder="Removed Phrase prefix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhraseSuffix1" type="text" placeholder="Removed Phrase suffix" style="width:24.5vw;height:2.5vh"/>
            </td>
        </tr>
        <tr>
            <td>
                <input id="AddedLinePrefix" type="text" placeholder="Added Line prefix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="AddedLineSuffix" type="text" placeholder="Added Line suffix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhrasePrefix2" type="text" placeholder="Removed Phrase prefix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhraseSuffix2" type="text" placeholder="Removed Phrase suffix" style="width:24.5vw;height:2.5vh"/>
            </td>
        </tr>
        <tr>
            <td>
                <input id="RemovedPhrasePrefix3" type="text" placeholder="Removed Phrase prefix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhraseSuffix3" type="text" placeholder="Removed Phrase suffix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhrasePrefix4" type="text" placeholder="Removed Phrase prefix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhraseSuffix4" type="text" placeholder="Removed Phrase suffix" style="width:24.5vw;height:2.5vh"/>
            </td>
        </tr>
        <tr>
            <td>
                <input id="RemovedPhrasePrefix5" type="text" placeholder="Removed Phrase prefix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhraseSuffix5" type="text" placeholder="Removed Phrase suffix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhrasePrefix6" type="text" placeholder="Removed Phrase prefix" style="width:24.5vw;height:2.5vh"/>
            </td>
            <td>
                <input id="RemovedPhraseSuffix6" type="text" placeholder="Removed Phrase suffix" style="width:24.5vw;height:2.5vh"/>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input id="OldIdentifier" type="text" placeholder="Old identifier" style="width:49vw;height:2.5vh"/>
            </td>
            <td colspan="2">
                <input id="NewIdentifier0" type="text" placeholder="New identifier" style="width:49vw;height:2.5vh"/>
                <input id="NewIdentifier1" type="text" placeholder="New identifier" style="width:49vw;height:2.5vh;display:none"/>
                <input id="NewIdentifier2" type="text" placeholder="New identifier" style="width:49vw;height:2.5vh;display:none"/>
                <input id="NewIdentifier3" type="text" placeholder="New identifier" style="width:49vw;height:2.5vh;display:none"/>
            </td>
        </tr>
        <tr>
            <td colspan="2">
            </td>
            <td colspan="2">
                <input id="NewLineOffset0" type="text" placeholder="New line offset" style="width:49vw;height:2.5vh"/>
                <input id="NewLineOffset1" type="text" placeholder="New line offset" style="width:49vw;height:2.5vh;display:none"/>
                <input id="NewLineOffset2" type="text" placeholder="New line offset" style="width:49vw;height:2.5vh;display:none"/>
                <input id="NewLineOffset3" type="text" placeholder="New line offset" style="width:49vw;height:2.5vh;display:none"/>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <textarea id="OldTranslation" placeholder="Old translated text" readonly spellcheck="false" onInput="SetRowCount( this )" style="width:49vw;height:50vh"></textarea>
            </td>
            <td colspan="2">
                <textarea id="NewTranslation0" placeholder="New translated text" spellcheck="false" onInput="SetRowCount( this )" style="width:49vw;height:50vh"></textarea>
                <textarea id="NewTranslation1" placeholder="New translated text" spellcheck="false" onInput="SetRowCount( this )" style="width:49vw;height:50vh;display:none"></textarea>
                <textarea id="NewTranslation2" placeholder="New translated text" spellcheck="false" onInput="SetRowCount( this )" style="width:49vw;height:50vh;display:none"></textarea>
                <textarea id="NewTranslation3" placeholder="New translated text" spellcheck="false" onInput="SetRowCount( this )" style="width:49vw;height:50vh;display:none"></textarea>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input id="OldRowCount" placeholder="0" readonly style="width:49vw;height:2.5vh"/>
            </td>
            <td colspan="2">
                <input id="NewRowCount0" placeholder="0" readonly style="width:49vw;height:2.5vh"/>
                <input id="NewRowCount1" placeholder="0" readonly style="width:49vw;height:2.5vh;display:none"/>
                <input id="NewRowCount2" placeholder="0" readonly style="width:49vw;height:2.5vh;display:none"/>
                <input id="NewRowCount3" placeholder="0" readonly style="width:49vw;height:2.5vh;display:none"/>
            </td>
        </tr>
    </tbody>
</table>
<button onclick="ExtractPhrases()" style="font-size:1.5vw">Extract</button>
<button onclick="ReplacePhrases()" style="font-size:1.5vw">Replace</button>
<button onclick="AddPhrases()" style="font-size:1.5vw">Add</button>
<input id="Translation0" type="radio" name="translation" onClick="ShowTranslation( 0 )">
<label for="Translation0" style="font-size:1.5vw">First translation</label>
<input id="Translation1" type="radio" name="translation" onClick="ShowTranslation( 1 )">
<label for="Translation1" style="font-size:1.5vw">Second translation</label>
<input id="Translation2" type="radio" name="translation" onClick="ShowTranslation( 2 )">
<label for="Translation2" style="font-size:1.5vw">Third translation</label>
<input id="Translation3" type="radio" name="translation" onClick="ShowTranslation( 3 )">
<label for="Translation3" style="font-size:1.5vw">Fourth translation</label>
<script>
    // -- FUNCTIONS

    function SetRowCount(
        phrase_array
        )
    {
        document.getElementById( phrase_array.id.split( "Translation" ).join( "RowCount" ) ).value
            = phrase_array.value.split( "\n" ).length;
    }

    // ~~

    function ShowTranslation(
        shown_translation_index
        )
    {
        for ( translation_index = 0;
              translation_index < 4;
              ++translation_index )
        {
            if ( translation_index === shown_translation_index )
            {
                display_value = "inline";
            }
            else
            {
                display_value = "none";
            }

            document.getElementById( "NewIdentifier" + translation_index ).style.display = display_value;
            document.getElementById( "NewLineOffset" + translation_index ).style.display = display_value;
            document.getElementById( "NewTranslation" + translation_index ).style.display = display_value;
            document.getElementById( "NewRowCount" + translation_index ).style.display = display_value;
        }
    }

    // ~~

    function GetPartArray(
        line,
        required_line_prefix,
        required_line_suffix,
        required_phrase_prefix,
        required_phrase_suffix
        )
    {
        var
            phrase_prefix_character_index,
            phrase_suffix_character_index;

        if ( required_line_prefix !== "" )
        {
            if ( line.startsWith( required_line_prefix ) )
            {
                line = line.substring( required_line_prefix.length );
            }
            else
            {
                return [];
            }
        }

        if ( required_line_suffix !== "" )
        {
            if ( line.endsWith( required_line_suffix ) )
            {
                line = line.substring( 0, line.length - required_line_suffix.length );
            }
            else
            {
                return [];
            }
        }

        if ( required_phrase_prefix !== "" )
        {
            phrase_prefix_character_index = line.indexOf( required_phrase_prefix );

            if ( phrase_prefix_character_index >= 0 )
            {
                required_phrase_prefix = line.substring( 0, phrase_prefix_character_index + required_phrase_prefix.length );
                line = line.substring( required_phrase_prefix.length );
            }
            else
            {
                return [];
            }
        }

        if ( required_phrase_suffix !== "" )
        {
            phrase_suffix_character_index = line.indexOf( required_phrase_suffix );

            if ( phrase_suffix_character_index >= 0 )
            {
                required_phrase_suffix = line.substring( phrase_suffix_character_index );
                line = line.substring( 0, phrase_suffix_character_index );
            }
            else
            {
                return [];
            }
        }

        return [ required_line_prefix + required_phrase_prefix, line, required_phrase_suffix + required_line_suffix ];
    }

    // ~~

    function ExtractPhrases(
        )
    {
        var
            required_line_prefix,
            required_line_suffix,
            old_line,
            old_line_array,
            old_line_index,
            old_part_array,
            old_phrase_array,
            old_translation_element,
            required_phrase_prefix,
            required_phrase_suffix;

        old_line_array = document.getElementById( "OldText" ).value.split( "\n" );

        required_line_prefix = document.getElementById( "RequiredLinePrefix" ).value;
        required_line_suffix = document.getElementById( "RequiredLineSuffix" ).value;

        required_phrase_prefix = document.getElementById( "RequiredPhrasePrefix" ).value;
        required_phrase_suffix = document.getElementById( "RequiredPhraseSuffix" ).value;

        added_line_prefix = document.getElementById( "AddedLinePrefix" ).value;
        added_line_suffix = document.getElementById( "AddedLineSuffix" ).value;

        old_phrase_array = [];

        for ( old_line_index = 0;
              old_line_index < old_line_array.length;
              ++old_line_index )
        {
            old_line = old_line_array[ old_line_index ];
            old_part_array = GetPartArray( old_line, required_line_prefix, required_line_suffix, required_phrase_prefix, required_phrase_suffix );

            if ( old_part_array.length == 3 )
            {
                old_phrase_array.push( added_line_prefix + old_part_array[ 1 ] + added_line_suffix );
            }
        }

        old_translation_element = document.getElementById( "OldTranslation" );
        old_translation_element.value = old_phrase_array.join( "\n" );

        SetRowCount( old_translation_element );
    }

    // ~~

    function GetLineOffset(
        text
        )
    {
        if ( text === "" )
        {
            return 1;
        }
        else
        {
            return text * 1;
        }
    }

    // ~~

    function IntegratePhrases(
        old_line_is_replaced = false
        )
    {
        var
            new_translation_index,
            required_line_prefix,
            required_line_suffix,
            new_line,
            new_line_array,
            new_line_index,
            new_line_offset,
            new_line_offset_array,
            new_identifier_array,
            new_phrase_array_array,
            new_translation_array,
            old_identifier,
            old_line,
            old_line_array,
            old_line_index,
            old_part_array,
            old_phrase_array,
            old_translation,
            phrase_index,
            removed_phrase_prefix,
            removed_phrase_prefix_array,
            removed_phrase_suffix,
            removed_phrase_suffix_array,
            required_phrase_prefix,
            required_phrase_suffix;

        old_line_array = document.getElementById( "OldText" ).value.split( "\n" );
        new_line_array = old_line_array.slice();

        required_line_prefix = document.getElementById( "RequiredLinePrefix" ).value;
        required_line_suffix = document.getElementById( "RequiredLineSuffix" ).value;

        required_phrase_prefix = document.getElementById( "RequiredPhrasePrefix" ).value;
        required_phrase_suffix = document.getElementById( "RequiredPhraseSuffix" ).value;

        removed_phrase_prefix_array =
            [
                document.getElementById( "RemovedPhrasePrefix0" ).value,
                document.getElementById( "RemovedPhrasePrefix1" ).value,
                document.getElementById( "RemovedPhrasePrefix2" ).value,
                document.getElementById( "RemovedPhrasePrefix3" ).value,
                document.getElementById( "RemovedPhrasePrefix4" ).value,
                document.getElementById( "RemovedPhrasePrefix5" ).value,
                document.getElementById( "RemovedPhrasePrefix6" ).value
            ];

        removed_phrase_suffix_array =
            [
                document.getElementById( "RemovedPhraseSuffix0" ).value,
                document.getElementById( "RemovedPhraseSuffix1" ).value,
                document.getElementById( "RemovedPhraseSuffix2" ).value,
                document.getElementById( "RemovedPhraseSuffix3" ).value,
                document.getElementById( "RemovedPhraseSuffix4" ).value,
                document.getElementById( "RemovedPhraseSuffix5" ).value,
                document.getElementById( "RemovedPhraseSuffix6" ).value
            ];

        old_identifier = document.getElementById( "OldIdentifier" ).value;
        new_identifier_array
            = [
                  document.getElementById( "NewIdentifier0" ).value,
                  document.getElementById( "NewIdentifier1" ).value,
                  document.getElementById( "NewIdentifier2" ).value,
                  document.getElementById( "NewIdentifier3" ).value
              ];

        new_line_offset_array
            = [
                  document.getElementById( "NewLineOffset0" ).value,
                  document.getElementById( "NewLineOffset1" ).value,
                  document.getElementById( "NewLineOffset2" ).value,
                  document.getElementById( "NewLineOffset3" ).value
              ];

        old_translation = document.getElementById( "OldTranslation" ).value;
        new_translation_array
            = [
                  document.getElementById( "NewTranslation0" ).value,
                  document.getElementById( "NewTranslation1" ).value,
                  document.getElementById( "NewTranslation2" ).value,
                  document.getElementById( "NewTranslation3" ).value
              ];

        old_phrase_array = old_translation.split( "\n" );
        new_phrase_array_array
            = [
                  new_translation_array[ 0 ].split( "\n" ),
                  new_translation_array[ 1 ].split( "\n" ),
                  new_translation_array[ 2 ].split( "\n" ),
                  new_translation_array[ 3 ].split( "\n" )
              ];

        phrase_index = 0;

        new_line_index = 0;

        for ( old_line_index = 0;
              old_line_index < old_line_array.length;
              ++old_line_index )
        {
            old_line = old_line_array[ old_line_index ];
            old_part_array = GetPartArray( old_line, required_line_prefix, required_line_suffix, required_phrase_prefix, required_phrase_suffix );

            if ( old_part_array.length == 3 )
            {
                if ( old_line_is_replaced )
                {
                    new_line_array.splice( new_line_index, 1 );

                    --new_line_index;
                }

                for ( new_translation_index = 0;
                      new_translation_index < 4;
                      ++new_translation_index )
                {
                    if ( new_translation_array[ new_translation_index ] !== "" )
                    {
                        if ( phrase_index < new_phrase_array_array[ new_translation_index ].length
                             && new_phrase_array_array[ new_translation_index ].length === old_phrase_array.length )
                        {
                            new_line_offset = new_line_offset_array[ new_translation_index ];

                            if ( new_line_offset === "" )
                            {
                                new_line_offset = 1;
                            }
                            else
                            {
                                new_line_offset *= 1;
                            }

                            new_phrase = new_phrase_array_array[ new_translation_index ][ phrase_index ];

                            for ( removed_phrase_prefix of removed_phrase_prefix_array )
                            {
                                if ( removed_phrase_prefix !== ""
                                     && new_phrase.startsWith( removed_phrase_prefix ) )
                                {
                                    new_phrase = new_phrase.substring( removed_phrase_prefix.length );

                                    break;
                                }
                            }

                            for ( removed_phrase_suffix of removed_phrase_suffix_array )
                            {
                                if ( removed_phrase_suffix !== ""
                                     && new_phrase.endsWith( removed_phrase_suffix ) )
                                {
                                    new_phrase = new_phrase.substring( 0, new_phrase.length - removed_phrase_suffix.length );

                                    break;
                                }
                            }

                            new_line
                                = old_part_array[ 0 ].split( old_identifier ).join( new_identifier_array[ new_translation_index ] )
                                  + new_phrase
                                  + old_part_array[ 2 ].split( old_identifier ).join( new_identifier_array[ new_translation_index ] );

                            new_line_array.splice(
                                new_line_index + new_line_offset,
                                0,
                                new_line
                                );

                            if ( new_line_offset <= 1 )
                            {
                                ++new_line_index;
                            }
                        }
                        else
                        {
                            document.getElementById( "Translation" + new_translation_index ).click();

                            alert( "Invalid line count : " + new_phrase_array_array[ new_translation_index ].length );

                            return;
                        }
                    }
                }

                ++phrase_index;
            }

            ++new_line_index;
        }

        document.getElementById( "NewText" ).value = new_line_array.join( "\n" );
    }

    // ~~

    function ReplacePhrases(
        )
    {
        IntegratePhrases( true );
    }

    // ~~

    function AddPhrases(
        )
    {
        IntegratePhrases( false );
    }

    // -- STATEMENTS

    document.getElementById( "OldText" ).addEventListener(
        "scroll",
        function (
            event
            )
        {
            document.getElementById( "NewText" ).scrollTop = event.currentTarget.scrollTop;
        }
        );

    document.getElementById( "NewText" ).addEventListener(
        "scroll",
        function (
            event
            )
        {
            document.getElementById( "OldText" ).scrollTop = event.currentTarget.scrollTop;
        }
        );

    document.getElementById( "OldTranslation" ).addEventListener(
        "scroll",
        function (
            event
            )
        {
            document.getElementById( "NewTranslation0" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation1" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation2" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation3" ).scrollTop = event.currentTarget.scrollTop;
        }
        );

    document.getElementById( "NewTranslation0" ).addEventListener(
        "scroll",
        function (
            event
            )
        {
            document.getElementById( "OldTranslation" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation1" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation2" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation3" ).scrollTop = event.currentTarget.scrollTop;
        }
        );

    document.getElementById( "NewTranslation1" ).addEventListener(
        "scroll",
        function (
            event
            )
        {
            document.getElementById( "NewTranslation0" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "OldTranslation" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation2" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation3" ).scrollTop = event.currentTarget.scrollTop;
        }
        );

    document.getElementById( "NewTranslation2" ).addEventListener(
        "scroll",
        function (
            event
            )
        {
            document.getElementById( "NewTranslation0" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation1" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "OldTranslation" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation3" ).scrollTop = event.currentTarget.scrollTop;
        }
        );

    document.getElementById( "NewTranslation3" ).addEventListener(
        "scroll",
        function (
            event
            )
        {
            document.getElementById( "NewTranslation0" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation1" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "NewTranslation2" ).scrollTop = event.currentTarget.scrollTop;
            document.getElementById( "OldTranslation" ).scrollTop = event.currentTarget.scrollTop;
        }
        );

    document.getElementById( "Translation0" ).click();
</script>
